<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="../../static/css/student_main.css">
</head>
<body>

<div class="wrap" style="overflow-y:scroll;">
    <div class="left_div">
        <h1>学生管理</h1>
    </div>
    <div class="search bar">
        <form>
            <input placeholder="搜索" name="cname" type="text" autocomplete="off">
            <button type="submit"></button>
        </form>
    </div>
    <div class="logout">
        <h4 class="h4_name">欢迎,{{ name }}同学</h4>
        <a href="/v1.0/logout">退出</a>&nbsp;&nbsp;&nbsp
        <a>联系我们</a>
    </div>
    <div id="app1">
        <div class="left_div2">
            <h3><a class="a_name" @click="grade" href="#">成绩记录</a></h3>
            <h3><a class="a_name" @click="total_expression" href="#">在校表现</a></h3>
            <h3><a class="a_name" @click="info" href="#">录入信息</a></h3>
            <h3><a class="a_name" @click="password" href="#">设置密码</a></h3>
            <h3><a class="a_name" @click="suggest" href="#">提交建议</a></h3>
        </div>
        <div v-show="level==1">
            <h2 class="h2_class">考试信息</h2>
            <div class="table_in">
                <table class="table table-striped tab">
                    <tr>
                        <th>考试时间</th>
                        <th>机试</th>
                        <th>笔试</th>
                        <th>总分</th>
                    </tr>
                    <tr class="tr_look" v-for="grade in grade_mes">
                        <td>{[ grade.exam_time ]}</td>
                        <td>{[ grade.competer_points ]}</td>
                        <td>{[ grade.write_points ]}</td>
                        <td>{[ grade.total_points ]}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div v-show="level==2">
            <h2 class="h2_class">在校表现</h2>
            <div class="table_in">
                <h3 class="tit">总学分: {[ expr_data ]}</h3>
                <table class="table table-striped tab">
                    <tr>
                        <th>事件缘由</th>
                        <th>奖罚</th>
                        <th>学分</th>
                        <th>发生时间</th>
                    </tr>
                    <tr class="tr_look" v-for="expr in expr_mes">
                        <td>{[ expr.reason ]}</td>
                        <td>{[ expr.punish ]}</td>
                        <td>{[ expr.result ]}</td>
                        <td>{[ expr.time ]}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div v-show="level==4">
            <h2 class="h2_class">设置密码</h2>
            <div class="container">
                <form>
                    <label><input type="text" placeholder="原密码" v-model="pwd" name="pwd" autocomplete="off"
                                  required/></label>
                    <label><input type="password" placeholder="更改密码" v-model="pwd1" name="pwd1" autocomplete="off"
                                  required/></label>
                    <label><input type="password" placeholder="确认密码" v-model="pwd2" name="pwd2" autocomplete="off"
                                  required/></label>
                    <p>{{ error }}</p>
                    <label><input type="button" @click="verify" value="提交"/></label>
                </form>
            </div>
        </div>
    </div>

</div>
<script src="../../static/js/axios.js"></script>
<script src="../../static/js/vue.js"></script>
<script>
    var app = new Vue({
        delimiters: ['{[', ']}'],
        el: '#app1',
        data: {
            level: 0,
            grade_mes: [],
            expr_mes: [],
            expr_data: '',
            pwd: '',
            pwd1: '',
            pwd2: '',
        },
        methods: {
            grade: function () {
                axios.post('http://127.0.0.1:8000/v1.0/data/grade')
                    .then((response) => {
                        this.grade_mes = response.data.points;
                        this.level = 1;
                        console.log(this.level);
                        console.log(this.grade_mes)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }, total_expression: function () {
                axios.post('http://127.0.0.1:8000/v1.0/data/expression')
                    .then((res) => {
                        this.expr_mes = res.data.expressions;
                        this.expr_data = res.data.credit;
                        this.level = 2;
                        console.log(this.level)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            info: function () {
            },
            password: function () {
                this.level = 4
            },
            suggest: function () {
            },
            verify: function () {
                console.log(this.pwd, this.pwd1);
                if (this.pwd1 === this.pwd2) {
                    axios.post('http://127.0.0.1:8000/v1.0/change/pwd', {
                        pwd: this.pwd,
                        pwd1: this.pwd1
                    })
                        .then((response) => {
                            if (response.data === '原密码错误') {
                                console.log(this.error);
                                this.error = '原密码错误';
                                console.log(this.error)
                            }
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                } else {
                    this.error = '两次密码不一样'
                }
            }
        }
    });
</script>
</body>
